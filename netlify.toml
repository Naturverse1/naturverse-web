[build]
  command = "npm run build"
  publish = "dist"
  functions = "netlify/functions"

# IMPORTANT: Do NOT rewrite /auth/*, only the callback document itself.
# Specific rules must come before the SPA catch-all.
[[redirects]]
  from = "/auth/callback"
  to   = "/index.html"
  status = 200
  force  = true

# Keep helper utilities served as actual files (no rewrites)
[[redirects]]
  from = "/kill-sw"
  to   = "/kill-sw.html"
  status = 200
  force = true

[[redirects]]
  from = "/kill-sw.js"
  to   = "/kill-sw.js"
  status = 200

[[redirects]]
  from = "/registerSW.js"
  to   = "/registerSW.js"
  status = 200

# SPA fallback (works for every other client route)
[[redirects]]
  from = "/*"
  to   = "/index.html"
  status = 200

# Minimal, permissive CSP for now (no inline hashes needed)
# Remove once everything is stable and you want to lock it down again.
[[headers]]
  for = "/*"
  [headers.values]
  Content-Security-Policy = "default-src 'self'; img-src 'self' data: blob: https:; connect-src 'self' https: wss:; script-src 'self'; style-src 'self'; frame-ancestors 'self'; base-uri 'self'; form-action 'self'"
  Referrer-Policy = "strict-origin-when-cross-origin"
  X-Frame-Options = "SAMEORIGIN"
  X-Content-Type-Options = "nosniff"
